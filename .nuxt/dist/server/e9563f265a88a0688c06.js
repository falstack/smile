exports.ids=[6],exports.modules={100:function(t,e,n){"use strict";n(47),n(17);var r=n(30),l=n.n(r),o=(n(48),n(29)),h={name:"QaItem",components:{VButton:n.n(o).a,VField:l.a},props:{item:{type:Object,required:!0},order:{type:Number,required:!0},isTrial:{type:Boolean,default:!1},extra:{type:Object,default:()=>{}}},data(){return{rightAnswer:(()=>{const t=this.item.id.toString(),e=this.extra.answers||{};let n="";const r=Object.keys(e);for(let i=0;i<r.length;i++)if(r[i].toString()===t){n=e[r[i]];break}return n})(),title:this.item.title,loading:!1}},methods:{changeRightAnswer(t){this.isTrial&&(this.rightAnswer=t)},answerNumber:t=>["A","B","C","D"][t],handleAnswerClick(t){this.isTrial||(this.rightAnswer=t,this.$emit("select",{questionId:this.item.id,answerId:t}))},handleUserClick(){this.$bridge.navigateTo({url:`/pages/user/show/index?slug=${this.item.user.slug}`})},handleBangumiClick(){this.$bridge.navigateTo({url:`/pages/bangumi/show/index?slug=${this.item.bangumi.slug}`})},handleDelete(){this.loading||this.$alert({title:"提示",message:"删除后不可恢复，确认要删除吗？",buttons:["取消","确定"],callback:t=>{t&&(this.loading=!0,this.$axios.$post("v1/join/delete",{id:this.item.id}).then(()=>{this.$toast.success("删除成功"),this.$emit("delete",this.item.id)}).catch(t=>{this.$toast.error(t.message)}).finally(()=>{this.loading=!1}))}})},handlePass(){!this.loading&&this.title&&(this.loading=!0,this.$axios.$post("v1/join/recommend",{id:this.item.id,right_id:this.rightAnswer,title:this.title}).then(()=>{this.$toast.success("入库成功"),this.$emit("delete",this.item.id)}).catch(t=>{this.$toast.error(t.message)}).finally(()=>{this.loading=!1}))}}},d=n(1);var component=Object(d.a)(h,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.$style.qaItem},[t._ssrNode("<div"+t._ssrClass(null,t.$style.header)+">","</div>",[t.isTrial?n("VField",{class:t.$style.title,attrs:{"min-row":1,"max-row":3,"max-len":50,close:!1,label:""+t.order},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}):[n("div",{class:t.$style.order,domProps:{textContent:t._s(t.order)}}),t._v(" "),n("p",{class:t.$style.title,domProps:{innerHTML:t._s(t.title)}})]],2),t._ssrNode(" <div"+t._ssrClass(null,t.$style.main)+">"+t._ssrList(t.item.answers,(function(e,n,r){var l,o;return"<div"+t._ssrClass(null,[t.$style.answer,(l={},l[t.$style.isSelected]=!t.isTrial&&n===t.rightAnswer,l)])+"><div"+t._ssrClass(null,[t.$style.order,(o={},o[t.$style.isRight]=t.isTrial&&n===t.rightAnswer,o)])+">"+t._ssrEscape(t._s(t.answerNumber(r)))+"</div> <p>"+t._s(e)+"</p></div>"}))+"</div> "),t._ssrNode("<div"+t._ssrClass(null,t.$style.footer)+">","</div>",[t._ssrNode("<div"+t._ssrClass(null,t.$style.intro)+'><div class="oneline"><span>出题人：</span> <span>'+t._ssrEscape(t._s(t.item.user.nickname))+"</span></div> "+(t.isTrial?'<div class="oneline"><span>番の剧：</span> <span>'+t._ssrEscape(t._s(t.item.bangumi.name))+"</span></div>":"\x3c!----\x3e")+"</div> "),t.isTrial?t._ssrNode("<div"+t._ssrClass(null,t.$style.control)+">","</div>",[n("VButton",{attrs:{size:"small",theme:"danger",text:""},on:{click:t.handleDelete}},[t._v("\n        拒绝\n      ")]),t._ssrNode(" "),n("VButton",{attrs:{size:"small",theme:"success"},on:{click:t.handlePass}},[t._v("\n        通过\n      ")])],2):t._e()],2)],2)}),[],!1,(function(t){var e=n(66);e.__inject__&&e.__inject__(t),this.$style=e.locals||e}),null,"52518a13");e.a=component.exports},108:function(t,e,n){"use strict";n.r(e);var r=n(69),l=n.n(r);for(var o in r)"default"!==o&&function(t){n.d(e,t,(function(){return r[t]}))}(o);e.default=l.a},163:function(t,e,n){"use strict";n.r(e);n(48),n(17);var r=n(29),l=n.n(r),o=n(54),h={name:"BangumiJoin",components:{QaItem:n(100).a,VButton:l.a},mixins:[o.a],data:()=>({showLaunch:!0,showCreate:!1,rule:null,sheet:null,bangumi:null,questions:[],selected:{},extra:null,loading:!1}),computed:{slug(){return this.$route.query.slug}},mounted(){this.getBangumiInfo(),this.getBangumiRule()},methods:{getBangumiRule(){this.$axios.$get("v1/join/rule/show",{params:{slug:this.slug}}).then(data=>{this.rule=data}).catch(t=>{this.$toast.error(t.message)})},getBangumiInfo(){this.$axios.$get("v1/bangumi/show",{params:{slug:this.slug}}).then(data=>{this.bangumi=data}).catch(t=>{this.$toast.error(t.message)})},handleBegin(){this.$axios.$post("v1/join/begin",{slug:this.slug}).then(t=>{"reject"===t?this.$toast.info("该分区还未开放"):"resolve"===t?this.$toast.info("你已加入该分区"):"no_rule"===t?this.$toast.info("还没有答题规则"):"no_question"===t?(this.$toast.info("分区题目数量不足"),this.showCreate=!0):"pending"===t&&this.getQuestions(),this.getQuestions()}).catch(t=>{this.$toast.error(t.message)})},getQuestions(){this.$axios.$get("v1/join/list",{params:{slug:this.slug}}).then(data=>{this.extra=data.extra,this.selected=data.extra.answers||{},this.questions=data.result,this.showLaunch=!1}).catch(t=>{this.$toast.error(t.message)})},handleSelect({questionId:t,answerId:e}){this.$axios.$post("v1/join/vote",{question_id:t,answer_id:e}).then(()=>{this.selected[t]=e}).catch(t=>{this.$toast.error(t.message)})},handleSubmit(){Object.keys(this.selected).length<this.questions.length?this.$toast.info("请先做完所有题目"):this.loading||(this.loading=!0,this.$axios.$post("v1/join/submit",{slug:this.slug}).then(t=>{this.$toast.info(t).then(()=>{this.$bridge.redirectTo({url:`/pages/bangumi/show/index?slug=${this.slug}`})})}).catch(t=>{this.$toast.error(t.message)}).finally(()=>{this.loading=!1}))}},head:()=>({title:"答题"})},d=n(1);var component=Object(d.a)(h,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"bangumi-join"}},[t.showLaunch?t._ssrNode('<div class="launch">',"</div>",[t._ssrNode((t.bangumi?"<img"+t._ssrAttr("src",t.$resize(t.bangumi.avatar,{width:150}))+' alt class="avatar"> <p>'+t._ssrEscape("加入《"+t._s(t.bangumi.name)+"》")+"</p>":"\x3c!----\x3e")+" "+(t.rule?"<ul><li>"+t._ssrEscape("该番剧出题："+t._s(t.rule.question_count)+"道")+"</li> <li>"+t._ssrEscape("正确率需要："+t._s(t.rule.right_rate)+"%")+"</li></ul>":"\x3c!----\x3e")+" "),n("VButton",{attrs:{type:"success",round:""},on:{click:t.handleBegin}},[t._v("\n      开始答题\n    ")]),t._ssrNode(" "),t.showCreate?n("NLink",{attrs:{to:"/bangumi/test?slug="+t.slug}},[t._v("\n      出题\n    ")]):t._e()],2):[t._l(t.questions,(function(e,r){return n("QaItem",{key:e.id,attrs:{order:r,extra:t.extra,item:e},on:{select:t.handleSelect}})})),t._ssrNode(" "),n("VButton",{attrs:{block:"",loading:t.loading,size:"large"},on:{click:t.handleSubmit}},[t._v("\n      交卷\n    ")])]],2)}),[],!1,(function(t){var e=n(108);e.__inject__&&e.__inject__(t)}),null,"582bcc44");e.default=component.exports},47:function(t,e){t.exports={}},48:function(t,e){t.exports={}},54:function(t,e,n){"use strict";e.a={beforeMount(){this.$channel.$when("user-not-sign",()=>{this.$toast.error("继续操作前请先登录").then(()=>{this.$bridge.redirectTo({url:`/pages/user/login/index?from=${encodeURIComponent(window.location.href)}`})})})}}},55:function(t,e){t.exports={"qa-item":"qa-item_3N5Xs",qaItem:"qa-item_3N5Xs",header:"header_AMObU",order:"order_2Lrmw",title:"title_-CJOD",main:"main_2bbkH",answer:"answer_12nXM","is-right":"is-right_2Bjlo",isRight:"is-right_2Bjlo","is-selected":"is-selected_1s5R_",isSelected:"is-selected_1s5R_",footer:"footer_3zt4D",intro:"intro_1Z2UY",control:"control_3tb4E"}},66:function(t,e,n){"use strict";n.r(e);var r=n(55),l=n.n(r);for(var o in r)"default"!==o&&function(t){n.d(e,t,(function(){return r[t]}))}(o);e.default=l.a},69:function(t,e){t.exports={}}};