/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{228:function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",(function(){return r}))},229:function(t,e,n){"use strict";function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}n.d(e,"a",(function(){return o}))},230:function(t,e,n){"use strict";n(37),n(44),n(35),n(25),n(109),n(110),n(58),n(9),n(36),n(57),n(111),n(28),n(80);var r=n(59),o=(n(29),n(6)),l=n(231);function c(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}e.a={data:function(){return{imageUploadToken:"",imageUploadAccept:["jpeg","png","jpg"],imageUploadAction:"https://upload.qiniup.com",imagePrefix:"https://m1.calibur.tv/"}},computed:{currentUser:function(){return this.$store.state.user},isAuth:function(){return this.$store.state.isAuth}},mounted:function(){var t=this;this.isAuth?this.initUpToken():this.$channel.$when("user-signed",(function(){t.initUpToken()}))},beforeDestroy:function(){this.getUpTokenTimer&&clearInterval(this.getUpTokenTimer)},methods:{initUpToken:function(){var t=this;this.getUpToken(),this.getUpTokenTimer=setInterval((function(){t.getUpToken()}),18e5)},getUpToken:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(l.a)(t);case 2:t.imageUploadToken=e.sent;case 3:case"end":return e.stop()}}),e)})))()},imageUploadRequest:function(data){var t,e,n;return data.key=(t={slug:this.currentUser.slug,file:data.file},e=t.slug,n=t.file,"".concat(e,"/").concat((new Date).getTime(),"-").concat(Math.random().toString(36).substring(3,6),".").concat(n.type.split("/").pop())),data.token=this.imageUploadToken,data},imageUploadResponse:function(t){try{return function(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?c(Object(source),!0).forEach((function(e){Object(r.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):c(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}({},t.data,{url:"".concat(this.imagePrefix).concat(t.data.url)})}catch(t){return{}}}}}},231:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return o}));n(44),n(9),n(57);var r=function(t){return t.$axios.$get("v1/image/uptoken")},o=function(t,e){return t.$axios.$post("https://up.qbox.me",e,{"Content-Type":"multipart/form-data"})}},232:function(t,e,n){"use strict";var r=n(2),o=n(162).trim;r({target:"String",proto:!0,forced:n(241)("trim")},{trim:function(){return o(this)}})},235:function(t,e,n){"use strict";e.a={beforeMount:function(){var t=this;this.$channel.$when("user-not-sign",(function(){t.$toast.error("继续操作前请先登录").then((function(){t.$bridge.redirectTo({url:"/pages/user/login/index?from=".concat(encodeURIComponent(window.location.href))})}))}))}}},236:function(t,e,n){"use strict";function r(t){return function(t){if(Array.isArray(t)){for(var i=0,e=new Array(t.length);i<t.length;i++)e[i]=t[i];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}n.d(e,"a",(function(){return r}))},239:function(t,e,n){},240:function(t,e,n){t.exports=function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=41)}({0:function(t,e,i){"use strict";function n(t,e,i,n,s,r,o,l){var a,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=i,c._compiled=!0),n&&(c.functional=!0),r&&(c._scopeId="data-v-"+r),o?(a=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),s&&s.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},c._ssrRegister=a):s&&(a=l?function(){s.call(this,this.$root.$options.shadowRoot)}:s),a)if(c.functional){c._injectStyles=a;var d=c.render;c.render=function(t,e){return a.call(e),d(t,e)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,a):[a]}return{exports:t,options:c}}i.d(e,"a",(function(){return n}))},41:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"v-radio",class:["v-radio--"+t.size,{"v-radio--circle":t.circle},t.inline?"v-radio--hoz":"v-radio--ver"]},[t.isSingle?i("div",{staticClass:"v-radio__item",class:{"is-disabled":t.disabled,"is-selected":t.selected},on:{click:t._singleToggle}},[i("div",{staticClass:"v-radio__label"}),t._v(" "),t.text?i("div",{staticClass:"v-radio__text",domProps:{textContent:t._s(t.text)}}):t._e()]):i("div",{staticClass:"v-radio__list"},t._l(t.text,(function(e){return i("div",{key:t.pureText?e:e.value,staticClass:"v-radio__item",class:[{"is-disabled":t.disabled||!t.pureText&&e.disabled||t.max&&t.selected.length>=t.max&&-1===t.selected.indexOf(t.pureText?e:e.value)},{"is-selected":-1!==t.selected.indexOf(t.pureText?e:e.value)}],on:{click:function(i){return t._multiToggle(e)}}},[i("div",{staticClass:"v-radio__label"}),t._v(" "),i("div",{staticClass:"v-radio__text",domProps:{textContent:t._s(t.pureText?e:e.label)}})])})),0)])};n._withStripped=!0,i(61);var s={name:"VRadio",props:{value:{type:[Boolean,Array],required:!0},text:{type:[String,Array],required:!0},size:{type:String,default:"normal",validator:function(t){return~["normal","small"].indexOf(t)}},max:{type:Number,default:0},min:{type:Number,default:0},disabled:{type:Boolean,default:!1},circle:{type:Boolean,default:!1},inline:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1}},data:function(){var t="[object Boolean]"===Object.prototype.toString.call(this.value);return{selected:this.value,pureText:!!t||"string"==typeof this.text[0],isSingle:t}},watch:{value:function(t){this.selected=t},selected:function(t){this.$emit("input",t)}},methods:{_singleToggle:function(){this.disabled||this.readonly||(this.selected=!this.selected)},_multiToggle:function(t){if(!(this.disabled||this.readonly||!this.pureText&&t.disabled)){var e=this.selected.indexOf(this.pureText?t:t.value);if(-1===e)this.max&&this.selected.length>=this.max||this.selected.push(this.pureText?t:t.value);else{if(this.min&&this.selected.length<=this.min)return;this.selected.splice(e,1)}}},checkAll:function(t){var e=this;this.isSingle?this.selected=t:t?(this.selected=[],this.text.forEach((function(t){e.selected.push(e.pureText?t:t.value)}))):this.selected=[]},toggleAll:function(){this.isSingle?this.selected=!this.selected:this.checkAll(!this.selected.length)}}},r=i(0),o=Object(r.a)(s,n,[],!1,null,null,null);o.options.__file="src/components/radio/radio.vue";var l=o.exports;e.default=l},61:function(t,e,i){}})},241:function(t,e,n){var r=n(5),o=n(163);t.exports=function(t){return r((function(){return!!o[t]()||"​᠎"!="​᠎"[t]()||o[t].name!==t}))}},260:function(t,e,n){"use strict";var r=n(2),o=n(39).find,l=n(114),c=n(18),d=!0,h=c("find");"find"in[]&&Array(1).find((function(){d=!1})),r({target:"Array",proto:!0,forced:d||!h},{find:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),l("find")},261:function(t,e,n){},262:function(t,e,n){t.exports=function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=24)}({0:function(t,e,n){"use strict";function r(t,e,n,r,o,i,s,a){var l,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=n,c._compiled=!0),r&&(c.functional=!0),i&&(c._scopeId="data-v-"+i),s?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),o&&o.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(s)},c._ssrRegister=l):o&&(l=a?function(){o.call(this,this.$root.$options.shadowRoot)}:o),l)if(c.functional){c._injectStyles=l;var u=c.render;c.render=function(t,e){return l.call(e),u(t,e)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,l):[l]}return{exports:t,options:c}}n.d(e,"a",(function(){return r}))},13:function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"v-drawer",class:["v-drawer--"+t.from,{"v-drawer--offset":!t.offset&&!t.offsetVal}],style:t.drawerStyle},[n("transition",{attrs:{name:"v-drawer--transition"}},[t.show?n("div",{ref:"wrap",staticClass:"v-drawer__wrap",style:t.wrapStyle,on:{touchstart:function(t){t.stopPropagation()},touchmove:function(t){t.stopPropagation()},touchend:function(t){t.stopPropagation()}}},[t.count?t._l(t.count,(function(e,r){return n("div",{key:e,staticClass:"v-drawer__item",class:{strict:t.strict}},[t._t(""+r)],2)})):t._t("default"),t._v(" "),t.cancel?[n("div",{staticClass:"v-drawer__line"}),t._v(" "),n("div",{staticClass:"v-drawer__footer",domProps:{textContent:t._s(t.cancel)},on:{click:function(e){t.show=!1}}})]:t._e()],2):t._e()])],1)};r._withStripped=!0,n(19);var o=n(4),i={name:"VDrawer",props:{value:{type:Boolean,required:!0},count:{type:Number,default:0,validator:function(t){return t>=0}},strict:{type:Boolean,default:!1},cancel:{type:String,default:""},from:{type:String,default:"bottom",validator:function(t){return~["left","right","top","bottom"].indexOf(t)}},size:{type:String,default:"60%"},mask:{type:Boolean,default:!0},lock:{type:Boolean,default:!0},dropdown:{type:Boolean,default:!1},offset:{type:Number,default:0}},data:function(){return{show:!1,offsetVal:0,overlayId:""}},computed:{drawerStyle:function(){var t={},e=this.offsetVal,n=this.from,r=this.offset||e;switch(n){case"top":t.top="".concat(r,"px");break;case"bottom":t.bottom="".concat(r,"px");break;case"left":t.left="".concat(r,"px");break;case"right":t.right="".concat(r,"px")}return t},wrapStyle:function(){var t={},e=this.from,n=this.strict;if(~["top","bottom"].indexOf(e)){if(t.width="100%",t.left=0,"top"===e?t.top=0:t.bottom=0,n)return t;t.height=this.size}else{if(t.height="100%",t.bottom=0,"left"===e?t.left=0:t.right=0,n)return t;t.width=this.size}return t}},watch:{value:function(t){this.dropdown&&t?this.calcParentRect():(this.toggle(t),this.show=t)},show:function(t){this.toggle(t),this.$emit("input",t)}},mounted:function(){this.show=this.value},methods:{calcParentRect:function(){if(this.offset)return this.toggle(!0),void(this.show=!0);var t=this.$el.parentNode.getBoundingClientRect();switch(this.from){case"top":this.offsetVal=t.top+t.height;break;case"bottom":this.offsetVal=document.documentElement.clientHeight-t.top;break;case"left":this.offsetVal=t.left+t.width;break;case"right":this.offsetVal=document.documentElement.clientWidth-t.left}this.toggle(!0),this.show=!0},toggle:function(t){var e=this;this.$nextTick((function(){if(t){if(e.overlayId)return;e.overlayId=o.default.show({el:e.$refs.wrap,show:e.mask,lock:e.lock,style:e.drawerStyle,unlock:e.$refs.wrap,click:function(){e.show=!1}})}else o.default.hide(e.overlayId),e.overlayId=""}))}}},s=n(0),a=Object(s.a)(i,r,[],!1,null,null,null);a.options.__file="src/components/drawer/drawer.vue",e.a=a.exports},19:function(t,e,n){},24:function(t,e,n){"use strict";n.r(e);var r=n(13);e.default=r.a},4:function(t,e,n){"use strict";n.r(e),n(9);var r=function(){return"undefined"==typeof window},o=function(t){return document.querySelector(t)},i=function(t){t=t||navigator.userAgent;var e=/(iPad).*OS\s([\d_]+)/.test(t);return{ios:!e&&/(iPhone\sOS)\s([\d_]+)/.test(t)||e,android:/(Android);?[\s/]+([\d.]+)?/.test(t)}},s=0,a=0,l=0,c=null,u=!1,d=[],h=function(t){if(r())return!1;if(!t)throw new Error("options must be provided");var e=!1,n={get passive(){e=!0}},o=function(){};window.addEventListener("__TUA_BSL_TEST_PASSIVE__",o,n),window.removeEventListener("__TUA_BSL_TEST_PASSIVE__",o,n);var i=t.capture;return e?t:void 0!==i&&i}({passive:!1}),f=function(t){t.cancelable&&t.preventDefault()},p=function(t){var e,n,p,m,v;r()||(i().ios?(t&&-1===d.indexOf(t)&&(t.ontouchstart=function(t){a=t.targetTouches[0].clientY,l=t.targetTouches[0].clientX},t.ontouchmove=function(e){1===e.targetTouches.length&&function(t,e){if(e){var n=e.scrollTop,r=e.scrollLeft,o=e.scrollWidth,i=e.scrollHeight,s=e.clientWidth,c=e.clientHeight,u=t.targetTouches[0].clientX-l,d=t.targetTouches[0].clientY-a,h=Math.abs(d)>Math.abs(u);if(h&&(d>0&&0===n||d<0&&n+c+1>=i)||!h&&(u>0&&0===r||u<0&&r+s+1>=o))return f(t)}t.stopPropagation()}(e,t)},d.push(t)),u||(document.addEventListener("touchmove",f,h),u=!0)):s<=0&&(c=i().android?(e=o("html"),n=o("body"),p=e.scrollTop||n.scrollTop,m=Object.assign({},e.style),v=Object.assign({},n.style),e.style.height="100%",e.style.overflow="hidden",n.style.top="-".concat(p,"px"),n.style.width="100%",n.style.height="auto",n.style.position="fixed",n.style.overflow="hidden",function(){e.style.height=m.height||"",e.style.overflow=m.overflow||"",["top","width","height","overflow","position"].forEach((function(t){n.style[t]=v[t]||""})),window.scrollTo(0,p)}):function(){var t=o("body"),e=Object.assign({},t.style),n=window.innerWidth-document.body.clientWidth;return t.style.overflow="hidden",t.style.boxSizing="border-box",t.style.paddingRight="".concat(n,"px"),function(){["overflow","boxSizing","paddingRight"].forEach((function(n){t.style[n]=e[n]||""}))}}()),s+=1)};e.default={show:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e="v-overlay-".concat(Math.random().toString(36).substring(3,6)),n=document.createElement("div"),r=void 0===t.md?/android/.test(window.navigator.userAgent.toLocaleLowerCase()):t.md;if(n.id=e,n.classList.add("v-overlay",r?"v-overlay--md":"v-overlay--ios"),t.click&&n.addEventListener("click",(function(){t.click()})),t.zIndex&&(n.style.zIndex=t.zIndex),!1!==t.lock&&(t.unlock?p(t.unlock):p()),t.style){var o="";Object.keys(t.style).forEach((function(e){o+="".concat(e,":").concat(t.style[e],";")})),n.setAttribute("style",o)}return t.el?t.el.parentNode.insertBefore(n,t.el):document.body.appendChild(n),!1===t.show?e:(setTimeout((function(){n.classList.add("v-overlay--show")}),0),e)},hide:function(t){var e=t?document.getElementById(t):document.querySelector(".v-overlay");e&&(e.classList.remove("v-overlay--show"),r()||(s-=1)>0||(i().ios||"function"!=typeof c?u&&(document.removeEventListener("touchmove",f,h),u=!1):c()),setTimeout((function(){e&&e.parentNode&&e.parentNode.removeChild(e)}),200))}}},9:function(t,e,n){}})},263:function(t,e,n){},264:function(t,e,n){t.exports={"pin-draft":"pin-draft_3apaf",pinDraft:"pin-draft_3apaf",poster:"poster_3ME69","default-poster":"default-poster_2JmY1",defaultPoster:"default-poster_2JmY1",body:"body_uaEmQ",title:"title_y3UjG"}},265:function(t,e,n){t.exports={"bangumi-option":"bangumi-option_1VN2B",bangumiOption:"bangumi-option_1VN2B",body:"body_3llvZ",poster:"poster_3Wjvi",content:"content_1f3Yk",extra:"extra_1R6jg"}},266:function(t,e,n){},310:function(t,e,n){},311:function(t,e,n){},312:function(t,e,n){},313:function(t,e,n){},314:function(t,e,n){"use strict";"undefined"!=typeof window&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(s){var t=this;if(!document.documentElement.contains(t))return null;do{if(t.matches(s))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null}))},315:function(t,e,n){},316:function(t,e,n){},317:function(t){t.exports=JSON.parse('{"name":"smile","version":"1.0.0","description":"My breathtaking Nuxt.js project","author":"falstack","private":true,"scripts":{"lint":"eslint --fix --ext .js,.vue --ignore-path .gitignore .","precommit":"yarn lint","dev":"cross-env NODE_ENV=development nodemon server/index.js --watch server","build":"nuxt build","start":"cross-env NODE_ENV=production node server/index.js","analyze":"nuxt build --analyze","generate":"nuxt generate"},"dependencies":{"@calibur/sakura":"^1.0.18","@codexteam/ajax":"^4.1.0","@editorjs/checklist":"^1.1.0","@editorjs/delimiter":"^1.1.0","@editorjs/editorjs":"^2.16.1","@editorjs/embed":"^2.2.1","@editorjs/header":"^2.4.0","@editorjs/image":"^2.3.3","@editorjs/link":"^2.1.3","@editorjs/list":"^1.4.0","@nuxtjs/axios":"5.9.5","cross-env":"7.0.0","koa":"^2.11.0","nuxt":"2.11.0","url-polyfill":"^1.1.8","v-copy":"^0.1.0","vue-mixin-store":"^1.2.0"},"devDependencies":{"@nuxtjs/eslint-config":"2.0.0","@nuxtjs/eslint-module":"1.1.0","@nuxtjs/style-resources":"^1.0.0","babel-eslint":"10.0.3","babel-plugin-component":"^1.1.1","core-js":"^3.6.4","eslint":"6.8.0","eslint-config-standard":"14.1.0","eslint-plugin-import":"2.20.1","eslint-plugin-jest":"23.6.0","eslint-plugin-node":"11.0.0","eslint-plugin-nuxt":"0.5.0","eslint-plugin-promise":"4.2.1","eslint-plugin-standard":"4.0.1","eslint-plugin-vue":"6.1.2","node-sass":"^4.13.1","nodemon":"2.0.2","qiniu-qupload":"^1.0.6","sass-loader":"^8.0.2"}}')},318:function(t,e,n){"use strict";var r=n(263);n.n(r).a},319:function(t,e,n){"use strict";var r=n(264),o=n.n(r);e.default=o.a},320:function(t,e,n){"use strict";var r=n(265),o=n.n(r);e.default=o.a},321:function(t,e,n){"use strict";var r=n(266);n.n(r).a},355:function(t,e,n){"use strict";n.r(e);n(37),n(44),n(35),n(260),n(25),n(60),n(109),n(110),n(58),n(36),n(61),n(28),n(29);var r=n(6),o=n(59),l=(n(261),n(56),n(262)),c=n.n(l),d=(n(226),n(227)),h=n.n(d),f=(n(237),n(238)),m=n.n(f),v=(n(30),n(9),n(31),n(32),n(52)),_=n(230),y=n(231),w=(n(232),n(27)),x=n(228),k=n(229),S=(n(310),function(){function t(e){var data=e.data,n=e.config,r=e.api;Object(x.a)(this,t),this.api=r,this._CSS={block:this.api.styles.block,settingsButton:this.api.styles.settingsButton,settingsButtonActive:this.api.styles.settingsButtonActive,wrapper:"ce-header"},this._settings=n,this._data=this.normalizeData(data),this.settingsButtons=[],this._element=this.getTag()}return Object(k.a)(t,[{key:"normalizeData",value:function(data){var t={};return"object"!==Object(w.a)(data)&&(data={}),t.text=data.text||"",t.level=parseInt(data.level)||this.defaultLevel.number,t}},{key:"render",value:function(){return this._element}},{key:"renderSettings",value:function(){var t=this,e=document.createElement("DIV");return this.levels.forEach((function(n){var r=document.createElement("SPAN");r.classList.add(t._CSS.settingsButton),t.currentLevel.number===n.number&&r.classList.add(t._CSS.settingsButtonActive),r.innerHTML=n.svg,r.dataset.level=n.number,r.addEventListener("click",(function(){t.setLevel(n.number)})),e.appendChild(r),t.settingsButtons.push(r)})),e}},{key:"setLevel",value:function(t){var e=this;this.data={level:t,text:this.data.text},this.settingsButtons.forEach((function(button){button.classList.toggle(e._CSS.settingsButtonActive,parseInt(button.dataset.level)===t)}))}},{key:"merge",value:function(data){var t={text:this.data.text+data.text,level:this.data.level};this.data=t}},{key:"validate",value:function(t){return""!==t.text.trim()}},{key:"save",value:function(t){return{text:t.innerHTML,level:this.currentLevel.number}}},{key:"getTag",value:function(){var t=document.createElement(this.currentLevel.tag);return t.innerHTML=this._data.text||"",t.classList.add(this._CSS.wrapper),t.contentEditable="true",t.dataset.placeholder=this._settings.placeholder||"",t}},{key:"onPaste",value:function(t){var content=t.detail.data,e=2;switch(content.tagName){case"H1":e=1;break;case"H3":e=3;break;case"H4":e=4;break;case"H5":e=5;break;case"H6":e=6}this.data={level:e,text:content.innerHTML}}},{key:"data",get:function(){return this._data.text=this._element.innerHTML,this._data.level=this.currentLevel.number,this._data},set:function(data){if(this._data=this.normalizeData(data),void 0!==data.level&&this._element.parentNode){var t=this.getTag();t.innerHTML=this._element.innerHTML,this._element.parentNode.replaceChild(t,this._element),this._element=t}void 0!==data.text&&(this._element.innerHTML=this._data.text||"")}},{key:"currentLevel",get:function(){var t=this,e=this.levels.find((function(e){return e.number===t._data.level}));return e||(e=this.defaultLevel),e}},{key:"defaultLevel",get:function(){return{number:2,tag:"H2"}}},{key:"levels",get:function(){return[]}}],[{key:"conversionConfig",get:function(){return{export:"text",import:"text"}}},{key:"sanitize",get:function(){return{level:{}}}},{key:"pasteConfig",get:function(){return{tags:["H1","H2","H3","H4","H5","H6"]}}},{key:"toolbox",get:function(){return{icon:'<svg width="11" height="14" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M7.6 8.15H2.25v4.525a1.125 1.125 0 0 1-2.25 0V1.125a1.125 1.125 0 1 1 2.25 0V5.9H7.6V1.125a1.125 1.125 0 0 1 2.25 0v11.55a1.125 1.125 0 0 1-2.25 0V8.15z"/></svg>',title:"标题"}}}]),t}()),C=(n(57),n(311),function(){function t(e){var data=e.data;Object(x.a)(this,t),this.data=data}return Object(k.a)(t,[{key:"render",value:function(){var t=document.createElement("div");t.classList.add("baidu-resource");var e=document.createElement("div");e.classList.add("baidu-resource-wrap"),t.appendChild(e);var n=document.createElement("input");n.classList.add("baidu-resource-url"),n.placeholder="仅支持百度云盘：pan.baidu.com",n.type="text",n.value=this.data&&this.data.url?this.data.url:"",e.appendChild(n);var r=document.createElement("input");r.classList.add("baidu-resource-password"),r.placeholder="填写资源的密码（4~6位）",r.type="text",r.value=this.data&&this.data.password?this.data.password:"",e.appendChild(r);var o=document.createElement("div");o.classList.add("baidu-resource-role-wrap");var l="".concat(Math.random().toString(36).substring(3,6)),c=this.data&&this.data.visit_type?this.data.visit_type:0,d=document.createElement("span");d.textContent="是否需要投食才能看到密码：",o.appendChild(d);var h=document.createElement("input");h.classList.add("baidu-resource-role-public"),h.id="baidu-resource-role-public-".concat(l),h.name=l,h.type="radio",h.value=0,h.checked=0===c,o.appendChild(h);var f=document.createElement("label");f.setAttribute("for","baidu-resource-role-public-".concat(l)),f.textContent="否",f.classList.add("baidu-resource-label"),o.appendChild(f);var m=document.createElement("input");m.classList.add("baidu-resource-role-private"),m.id="baidu-resource-role-private-".concat(l),m.type="radio",m.name=l,m.value=1,m.checked=1===c,o.appendChild(m);var v=document.createElement("label");return v.setAttribute("for","baidu-resource-role-private-".concat(l)),v.textContent="是",v.classList.add("baidu-resource-label"),o.appendChild(v),e.appendChild(o),t}},{key:"save",value:function(t){var e=t.querySelector(".baidu-resource-url"),n=t.querySelector(".baidu-resource-password"),r=t.querySelector(".baidu-resource-role-public"),o=e.value.trim();return/^https?:\/\//.test(o)||(o="https://"+o),{url:o,password:n.value.trim(),visit_type:r.checked?0:1}}},{key:"validate",value:function(t){return!(!t.url||!t.password)&&!(!/https?:\/\/pan\.baidu\.com\/s\/([\w\W]+)/.test(t.url)||!/^[\w|\W]{4,6}$/.test(t.password))}}],[{key:"toolbox",get:function(){return{title:"百度云",icon:'<svg version="1" xmlns="http://www.w3.org/2000/svg" width="28px" height="28px" viewBox="0 0 298 298" preserveAspectRatio="xMidYMid meet"><g stroke="none"><path d="M135.2 75.6c-11 2.9-20.1 9.5-26.5 19.1-5.1 7.6-7.4 14.6-8.4 24.5-.6 7.4.2 6.7-9.8 8.4-15.2 2.6-30.5 16.1-35.6 31.2-1.8 5.4-2 8.1-1.7 17.5.4 10.6.6 11.6 4.2 18.6 6.5 12.8 17.1 20.9 31.9 24.8 12.1 3.1 26.8.2 37.9-7.5 2.4-1.6 12.2-11.9 21.8-22.8 32.9-37.3 35.7-39.7 46.5-39.7 12.9.1 21.4 8.4 24 23.6.3 2.2 1.1 4.9 1.6 6.1 2.3 5.1 11.4 7.3 16.4 4 12.6-8.3-.4-41.6-19.8-50.8-5.8-2.7-16.1-5.6-20.1-5.6-2.4 0-2.6-.3-2.6-4.4 0-21.7-15.1-41.8-35.4-47.2-6.5-1.7-17.6-1.7-24.4.2zm19.4 21.9c5.7 1.7 12.8 8 15.2 13.5 1.9 4.5 1.8 14.5-.2 19.1-3.7 8.7-12.1 13.9-22.4 13.9-6.2 0-7.5-.4-11.8-3.3-7.4-4.9-10.7-10.4-11.2-18.3-.6-8.7 1.5-14.1 7.8-19.7 7.3-6.6 13.4-8 22.6-5.2zm-44.7 54.4c5 2.6 10.7 9.1 12 13.8 4.6 16.4-5.9 31.5-21.8 31.5-13.6.1-24.1-10-24.1-23.2 0-9.3 5.7-18.6 13.5-22.1 5.5-2.5 15.4-2.5 20.4 0zM225 200.7c-3.9 2.7-4.9 4.5-5 9 0 3.3.6 5 2.9 7.5 2.6 2.9 3.5 3.3 8.1 3.3s5.5-.4 8.1-3.3c6.4-7.2 2.1-18.2-7.3-18.2-2.5 0-5.4.7-6.8 1.7z"/></g></svg>'}}}]),t}()),E=(n(312),function(){function t(e){var data=e.data,n=(e.config,e.api);Object(x.a)(this,t),this.api=n,this._CSS={block:this.api.styles.block,wrapper:"ce-delimiter"},this._data={},this._element=this.drawView(),this.data=data}return Object(k.a)(t,null,[{key:"contentless",get:function(){return!0}}]),Object(k.a)(t,[{key:"drawView",value:function(){var div=document.createElement("DIV");return div.classList.add(this._CSS.wrapper,this._CSS.block),div}},{key:"render",value:function(){return this._element}},{key:"save",value:function(t){return{}}}],[{key:"toolbox",get:function(){return{icon:'<svg width="19" height="4" viewBox="0 0 19 4" xmlns="http://www.w3.org/2000/svg"><path d="M1.25 0H7a1.25 1.25 0 1 1 0 2.5H1.25a1.25 1.25 0 1 1 0-2.5zM11 0h5.75a1.25 1.25 0 0 1 0 2.5H11A1.25 1.25 0 0 1 11 0z"/></svg>',title:"分割线"}}}]),t}()),O=(n(81),n(113),n(236)),$=(n(313),n(314),function(){function t(e){var data=e.data,n=(e.config,e.api);Object(x.a)(this,t),this._elements={wrapper:null,items:[]},this._data={items:[]},this.api=n,this.data=data}return Object(k.a)(t,null,[{key:"enableLineBreaks",get:function(){return!0}},{key:"toolbox",get:function(){return{icon:'<svg width="15" height="15" viewBox="0 0 15 15" xmlns="http://www.w3.org/2000/svg"><path d="M7.5 15a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15zm0-2.394a5.106 5.106 0 1 0 0-10.212 5.106 5.106 0 0 0 0 10.212zm-.675-4.665l2.708-2.708 1.392 1.392-2.708 2.708-1.392 1.391-2.971-2.971L5.245 6.36l1.58 1.58z"/></svg>',title:"进度表"}}}]),Object(k.a)(t,[{key:"render",value:function(){var t=this;if(this._elements.wrapper=this._make("div",[this.CSS.baseBlock,this.CSS.wrapper]),this._data.items.length)this._data.items.forEach((function(e){var n=t.createChecklistItem(e);t._elements.items.push(n),t._elements.wrapper.appendChild(n)}));else{var e=this.createChecklistItem();this._elements.items.push(e),this._elements.wrapper.appendChild(e)}return this._elements.wrapper.addEventListener("keydown",(function(e){switch(e.keyCode){case 13:t.appendNewElement(e);break;case 8:t.backspace(e)}}),!1),this._elements.wrapper.addEventListener("click",(function(e){t.toggleCheckbox(e)})),this._elements.wrapper}},{key:"validate",value:function(t){return!!t.items.length}},{key:"toggleCheckbox",value:function(t){var e=t.target.closest(".".concat(this.CSS.item));e.querySelector(".".concat(this.CSS.checkbox)).contains(t.target)&&e.classList.toggle(this.CSS.itemChecked)}},{key:"createChecklistItem",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this._make("div",this.CSS.item),n=this._make("span",this.CSS.checkbox),r=this._make("div",this.CSS.textField,{innerHTML:t.text?t.text:"",contentEditable:!0});return t.checked&&e.classList.add(this.CSS.itemChecked),e.appendChild(n),e.appendChild(r),e}},{key:"appendNewElement",value:function(t){t.preventDefault();var e=window.getSelection().anchorNode,n=this._elements.items[this._elements.items.length-1].querySelector(".".concat(this.CSS.textField)),r=n.innerHTML.replace("<br>"," ").trim();if(e===n&&!r)return this.api.blocks.insertNewBlock(),void t.stopPropagation();var o=this.createChecklistItem(),l=e.parentNode.closest(".".concat(this.CSS.item));this._elements.wrapper.insertBefore(o,l.nextSibling);var c=this._elements.items.indexOf(l)+1;this._elements.items.splice(c,0,o),this.moveCaretToEnd(o.querySelector(".".concat(this.CSS.textField)))}},{key:"backspace",value:function(t){var e=t.target.closest(".".concat(this.CSS.item)),n=this._elements.items.indexOf(e),r=e.querySelector(".".concat(this.CSS.textField)).innerHTML.replace("<br>"," ").trim();this._elements.items[0].querySelector(".".concat(this.CSS.textField)).innerHTML.replace("<br>"," ").trim()&&n&&!r&&(t.preventDefault(),e.remove(),this._elements.items.splice(n,1),"undefined"!==this._elements.items[n-1]&&this.moveCaretToEnd(this._elements.items[n-1].querySelector(".".concat(this.CSS.textField))))}},{key:"save",value:function(){return this.data}},{key:"_make",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=document.createElement(t);Array.isArray(n)?(e=o.classList).add.apply(e,Object(O.a)(n)):n&&o.classList.add(n);for(var l in r)o[l]=r[l];return o}},{key:"moveCaretToEnd",value:function(element){var t=document.createRange(),e=window.getSelection();t.selectNodeContents(element),t.collapse(!1),e.removeAllRanges(),e.addRange(t)}},{key:"CSS",get:function(){return{baseBlock:this.api.styles.block,wrapper:"cdx-checklist",item:"cdx-checklist__item",itemChecked:"cdx-checklist__item--checked",checkbox:"cdx-checklist__item-checkbox",textField:"cdx-checklist__item-text"}}},{key:"data",set:function(t){this._data.items=t.items||[];var e=this._elements.wrapper;e&&e.parentNode.replaceChild(this.render(),e)},get:function(){this._data.items=[];for(var i=0;i<this._elements.items.length;i++){var t=this._elements.items[i].querySelector(".".concat(this.CSS.textField)).innerHTML.replace("<br>"," ").trim();t&&this._data.items.push({text:t,checked:this._elements.items[i].classList.contains(this.CSS.itemChecked)})}return this._data}}]),t}()),j=(n(315),function(){function t(e){var data=e.data,n=e.config,r=e.api;Object(x.a)(this,t),this.api=r,this._CSS={block:this.api.styles.block,wrapper:"ce-paragraph"},this.onKeyUp=this.onKeyUp.bind(this),this._placeholder=n.placeholder?n.placeholder:t.DEFAULT_PLACEHOLDER,this._data={},this._element=this.drawView(),/^<input /gi.test(data.text)&&(data={}),this.data=data}return Object(k.a)(t,null,[{key:"DEFAULT_PLACEHOLDER",get:function(){return""}}]),Object(k.a)(t,[{key:"onKeyUp",value:function(t){"Backspace"!==t.code&&"Delete"!==t.code||""===this._element.textContent&&(this._element.innerHTML="")}},{key:"drawView",value:function(){var div=document.createElement("DIV");return div.classList.add(this._CSS.wrapper,this._CSS.block),div.contentEditable=!0,div.dataset.placeholder=this._placeholder,div.addEventListener("keyup",this.onKeyUp),div}},{key:"render",value:function(){return this._element}},{key:"merge",value:function(data){this.data={text:this.data.text+data.text}}},{key:"validate",value:function(t){return!(""===t.text.trim()||/vanced issues found/.test(t.text))}},{key:"save",value:function(t){return{text:t.innerHTML}}},{key:"onPaste",value:function(t){this.data={text:t.detail.data.innerHTML}}},{key:"data",get:function(){return this._data.text=this._element.innerHTML,this._data},set:function(data){this._data=data||{},this._element.innerHTML=this._data.text||""}}],[{key:"conversionConfig",get:function(){return{export:"text",import:"text"}}},{key:"sanitize",get:function(){return{text:{br:!0}}}},{key:"pasteConfig",get:function(){return{tags:["P"]}}}]),t}()),T=(n(111),n(316),function(){function t(e){var data=e.data,n=e.api;Object(x.a)(this,t),this.data=data,this.api=n,this.i=0}return Object(k.a)(t,[{key:"render",value:function(){var t=this;if(!(document.querySelectorAll(".vote-wrap").length>0)){var e=document.createElement("div");e.classList.add("vote-wrap");var n=document.createElement("p");n.textContent="投票（文章发表后无法再修改）";var r=document.createElement("ul"),o=document.createElement("div");o.classList.add("vote-append","bili-font","ic_add");var l=function(text){var n=document.createElement("li"),label=document.createElement("span");label.textContent="".concat(++t.i,". ");var input=document.createElement("input");if(input.type="text",input.placeholder="请输入选项（20字以内）",text&&(input.value=("string"==typeof text?text:text.text)||""),input.maxLength=20,input.classList.add("vote-answer"),n.classList.add("vote-wrap-item"),n.appendChild(label),n.appendChild(input),t.i>2){var l=document.createElement("div");l.classList.add("bili-font","ic_input_close"),l.addEventListener("click",(function(){r.removeChild(n),t.i--,t.i<100&&(o.style.display="block");var l=e.querySelector(".vote-wrap-select-count");l&&(l.max=t.i,l.value-t.i>0&&(l.value=t.i))})),n.appendChild(l)}r.appendChild(n),input.focus()};o.addEventListener("click",(function(){l(),t.i>=100&&(o.style.display="none");var n=e.querySelector(".vote-wrap-select-count");n&&(n.max=t.i)}));e.appendChild(n),e.appendChild(r);var c=document.createElement("div");return c.classList.add("append-btn-wrap"),c.appendChild(o),e.appendChild(c),this.data&&this.data.items?this.data.items.forEach(l):(l(),l()),function(){var footer=document.createElement("footer"),n=document.createElement("span");n.textContent="可选个数";var r=document.createElement("input");r.type="number",r.classList.add("vote-wrap-select-count"),r.min=1,t.data&&t.data.max_select?r.value=t.data.max_select:r.value=1,r.max=t.i;var o=document.createElement("div");o.classList.add("footer-item-wrap"),o.appendChild(n),o.appendChild(r),footer.appendChild(o);var l=document.createElement("span");l.textContent="截止时间（可选）";var c=document.createElement("input");c.type="date",c.min=new Date(Date.now()+864e5).toISOString().split("T")[0],c.classList.add("vote-expire-input"),t.data&&t.data.expired_at&&(c.value=new Date(1e3*t.data.expired_at).toISOString().split("T")[0]);var d=document.createElement("div");d.classList.add("footer-item-wrap"),d.appendChild(l),d.appendChild(c),footer.appendChild(d),e.appendChild(footer)}(),e}this.api.notifier.show({message:"一篇文章只能包含一个投票",style:"error"})}},{key:"save",value:function(t){var e=t.querySelectorAll(".vote-answer"),n=[];[].forEach.call(e,(function(t){n.push(t.value)}));var r=t.querySelector(".vote-expire-input");return{items:n.map((function(t){return t.trim()})).filter((function(t){return t})),right_ids:[],max_select:+t.querySelector(".vote-wrap-select-count").value,expired_at:r&&r.value?parseInt(new Date(r.value).getTime()/1e3):0}}},{key:"validate",value:function(t){return t.items.length>1}}],[{key:"toolbox",get:function(){return{title:"投票",icon:'<svg version="1" xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 300 298" preserveAspectRatio="xMidYMid meet"><g stroke="none"><path d="M109.5 62.4l-2.5 2.5v140.2l2.5 2.4c2.3 2.4 3 2.5 14.7 2.5 6.8 0 13.3-.3 14.6-.6 5.2-1.4 5.2-.8 5.2-75.1 0-66.3-.1-68.9-2-71.3-1.8-2.4-2.3-2.5-15.9-2.8-13.9-.3-14.1-.3-16.6 2.2zM50.2 100l-2.2 2.1v103.8l2.6 2c2.4 1.9 4 2.1 15 2.1 13.8 0 16.8-.9 18.4-5.3 1.4-4.2 1.4-97.3-.1-101.6-.6-1.7-1.9-3.6-2.9-4.1-1-.6-7.9-1-15.2-1-12.1 0-13.6.2-15.6 2zM230.4 109.4c-1.7.8-3.4 2.1-3.8 3.1-.3.9-.6 22.1-.6 47.1v45.5l2.5 2.4c2.3 2.4 3 2.5 14.9 2.5 14 0 17-.9 18.6-5.3 1.5-4.3 1.4-86.3-.1-90.7-.8-2.2-2.2-3.7-4.5-4.6-4.4-1.8-22.7-1.8-27 0zM170.3 158.2c-1.2.6-2.7 2.4-3.2 4.1-1.4 3.9-1.4 38.5-.1 42.4 1.6 4.4 4.6 5.3 18.6 5.3 11.9 0 12.6-.1 14.9-2.5 2.5-2.4 2.5-2.4 2.5-24s0-21.6-2.5-24c-2.3-2.4-2.9-2.5-15.2-2.4-7 0-13.8.5-15 1.1zM49.2 223.2c-1.9 1.9-1.5 6.6.7 7.8 1.3.7 36 1 105.3 1 84.4 0 103.8-.2 105.2-1.3 2.2-1.6 2.5-6.5.5-7.8-2.3-1.4-210.3-1.1-211.7.3z"/></g></svg>'}}}]),t}()),L=n(317),D={name:"JsonEditor",mixins:[_.a],props:{value:{required:!0,type:Array},slug:{type:String,default:""}},data:function(){return{editor:null}},mounted:function(){this.initEditor()},methods:{initEditor:function(){var t=this;Promise.all([n.e(30).then(n.t.bind(null,352,7)),n.e(28).then(n.bind(null,374)),Promise.all([n.e(27),n.e(29)]).then(n.bind(null,353))]).then((function(e){var data,n=t;n.slug?data={blocks:n.value,time:Date.now(),version:n.$cache.get("editor_version",L.dependencies["@editorjs/editorjs"].replace("^",""))}:(data=n.$cache.get("editor_local_draft"))&&n.$emit("input",data.blocks);var r=e.map((function(t){return t.default})),o=Object(v.a)(r,3),l=o[0],c=o[1],d=o[2],h=new l({data:n.decodeData(data||{}),holder:"codex-editor",placeholder:"请输入正文（建议在15000字以内）",autofocus:!1,tools:{header:{class:S,inlineToolbar:!0},image:{class:c,types:"image/jpeg, image/png, image/jpg",config:{uploader:{uploadByFile:function(t){return new Promise((function(e,r){var o=new FormData;o.append("file",t),o.append("token",n.imageUploadToken),Object(y.b)(n,o).then((function(data){data.url="https://m1.calibur.tv/".concat(data.url),e({success:1,file:data})})).catch(r)}))}}}},link:{class:d,config:{endpoint:"".concat("https://api.calibur.tv/","v1/pin/editor/fetch_site")}},delimiter:{class:E},checklist:{class:$,inlineToolbar:!0},baidu:{class:C},paragraph:{class:j},vote:{class:T}},onChange:function(){n.handleSave()}});h.isReady.then((function(){t.editor=h,t.bindSaveEvent(),t.handleSave()})).catch((function(e){t.$toast.error("编辑器初始化失败：".concat(e))}))}))},bindSaveEvent:function(){var t=this;document.addEventListener("keydown",(function(e){83===e.keyCode&&(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),e.preventDefault(),t.handleSave())}),!1)},handleSave:function(){var t=this;this.editor&&this.editor.save().then((function(e){var n=t.encodeData(e);t.slug||(t.$cache.set("editor_local_draft",n),t.$cache.set("editor_version",n.version)),t.value&&t.$emit("input",n.blocks),t.$emit("save")})).catch((function(){t.$toast.error("保存失败")}))},decodeData:function(t){var e=t.version,n=t.blocks,time=t.time;return n?{version:e,blocks:n,time:time}:null},encodeData:function(t){return{version:t.version,blocks:t.blocks,time:t.time}}}},B=(n(318),n(24)),P=Object(B.a)(D,(function(){var t=this.$createElement;this._self._c;return this._m(0)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"editor-wrap"},[e("div",{staticClass:"mousetrap",attrs:{id:"codex-editor"}})])}],!1,null,null,null).exports,M=n(235),U={name:"PinDraftItem",props:{item:{type:Object,required:!0}},computed:{noPoster:function(){return!this.item.title.banner}},methods:{handleClick:function(){this.$emit("click")}}},A=n(319);var V=Object(B.a)(U,(function(){var t,e=this,n=e.$createElement,r=e._self._c||n;return r("div",{class:e.$style.pinDraft,on:{click:e.handleClick}},[r("img",{class:[e.$style.poster,(t={},t[e.$style.defaultPoster]=e.noPoster,t)],attrs:{src:e.$resize(e.noPoster?"default-poster":e.item.title.banner.url,{width:200,height:150})}}),e._v(" "),r("div",{class:e.$style.body},[r("div",{staticClass:"oneline",class:e.$style.title,domProps:{textContent:e._s(e.item.title.text)}}),e._v(" "),r("p",{class:e.$style.time,domProps:{textContent:e._s(e.$utils.timeAgo(e.item.last_edit_at))}})])])}),[],!1,(function(t){this.$style=A.default.locals||A.default}),null,null).exports,H=(n(239),n(240)),z={name:"BangumiOptionItem",components:{VRadio:n.n(H).a},props:{item:{type:Object,required:!0},type:{type:String,default:"follow"},selectedSlug:{type:String,default:""}},data:function(){return{isSelected:this.item.slug===this.selectedSlug}},methods:{handleClick:function(){"select"===this.type&&this.$emit("click")}}},I=n(320);var R=Object(B.a)(z,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.$style.bangumiOption,on:{click:t.handleClick}},[n("img",{class:t.$style.poster,attrs:{src:t.$resize(t.item.avatar,{width:120,height:120})}}),t._v(" "),n("div",{class:t.$style.body},[n("div",{class:t.$style.content},[n("div",{staticClass:"oneline",class:t.$style.title,domProps:{textContent:t._s(t.item.name)}})]),t._v(" "),n("div",{class:t.$style.extra},["select"===t.type?n("VRadio",{attrs:{text:"",circle:"",readonly:""},model:{value:t.isSelected,callback:function(e){t.isSelected=e},expression:"isSelected"}}):t._e()],1)])])}),[],!1,(function(t){this.$style=I.default.locals||I.default}),null,null).exports;function N(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function F(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?N(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):N(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var W={name:"WritePin",components:{VField:m.a,VButton:h.a,Editor:P,VDrawer:c.a,PinDraftItem:V,BangumiOptionItem:R},mixins:[M.a,_.a],asyncData:function(t){var e=t.app,n=t.error,r=t.query.slug;if(r)return e.$axios.$get("v1/pin/update/content",{params:{slug:r}}).then((function(data){return F({},data)})).catch(n)},data:function(){return{slug:"",title:{banner:null,text:""},content:[],bangumi_slug:"",last_edit_at:"",published_at:"",selectedBangumi:null,loading:!1,renderEditor:!0,toggleDraftDrawer:!1,toggleBangumiDrawer:!1}},computed:{draftSource:function(){return this.$store.getters["flow/getFlow"]({func:"getUserDrafts",type:"page"})||{}},bangumiSource:function(){return this.$store.getters["flow/getFlow"]({func:"getUserBangumi",type:"page",query:{slug:this.currentUser.slug}})||{}}},mounted:function(){this.initCache(),this.initUserDraft(),this.initUserBangumi()},methods:{initCache:function(){this.slug||(this.$cache.has("editor_local_draft_title")&&(this.title=this.$cache.get("editor_local_draft_title")),this.$cache.has("editor_local_draft_bangumi")&&(this.selectedBangumi=this.$cache.get("editor_local_draft_bangumi"),this.selectedBangumi&&(this.bangumi_slug=this.selectedBangumi.slug)))},initUserDraft:function(){this.$refs.draftLoader&&this.$refs.draftLoader.initData()},initUserBangumi:function(){var t=this;this.$channel.$when("user-signed",Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.$refs.areaLoader){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.$refs.areaLoader.initData();case 4:t.bangumi_slug?t.selectedBangumi=t.bangumiSource.result.find((function(e){return e.slug===t.bangumi_slug})):t.selectedBangumi=t.bangumiSource.result[0],t.bangumi_slug=t.selectedBangumi.slug;case 6:case"end":return e.stop()}}),e)}))))},onEditorSave:function(){this.saveTitle(),this.saveBangumi()},saveTitle:function(){this.slug||this.$cache.set("editor_local_draft_title",this.title)},preValidate:function(){return!!this.loading||(this.title.text?this.content.length?(this.loading=!0,!1):(this.$toast.info("内容不能为空"),!0):(this.$toast.info("标题不能为空"),!0))},actionCreate:function(t){var e=this;this.preValidate()||this.$axios.$post("v1/pin/create/story",{bangumi_slug:this.bangumi_slug,content:[{type:"title",data:this.title}].concat(this.content),publish:t}).then((function(n){e.removeCache(),t?e.$bridge.redirectTo({url:"/pages/pin/show/index?slug=".concat(n)}):e.switchDraft(n),e.loading=!1})).catch((function(t){e.$toast.error(t.message),e.loading=!1}))},actionUpdate:function(t){var e=this;this.preValidate()||this.$axios.$post("v1/pin/update/story",{slug:this.slug,bangumi_slug:this.bangumi_slug,content:[{type:"title",data:this.title}].concat(this.content),publish:t}).then((function(n){t&&e.$bridge.redirectTo({url:"/pages/pin/show/index?slug=".concat(n)}),e.loading=!1})).catch((function(t){e.$toast.error(t.message),e.loading=!1}))},removeCache:function(){this.$cache.del("editor_local_draft_title"),this.$cache.del("editor_local_draft_bangumi"),this.$cache.del("editor_local_draft")},clearPageData:function(){var t=this;this.renderEditor=!1,this.slug="",this.title={banner:null,text:""},this.bangumi_slug="",this.last_edit_at="",this.published_at="",this.content=[],this.toggleDraftDrawer=!1,this.selectedBangumi=this.bangumiSource.result[0],this.$nextTick((function(){t.renderEditor=!0}))},updatePageData:function(data){var t=this;this.renderEditor=!1,this.slug=data.slug,this.title=data.title,this.last_edit_at=data.last_edit_at,this.published_at=data.published_at,this.bangumi_slug=data.bangumi_slug,this.content=data.content,this.toggleDraftDrawer=!1,this.bangumi_slug?this.selectedBangumi=this.bangumiSource.find((function(e){return e.slug===t.bangumi_slug})):this.selectedBangumi=this.bangumiSource.result[0],this.$nextTick((function(){t.renderEditor=!0}))},switchBangumi:function(t){this.toggleBangumiDrawer=!1,this.selectedBangumi=t,this.bangumi_slug=t.slug,this.saveBangumi()},saveBangumi:function(){this.$cache.set("editor_local_draft_bangumi",this.selectedBangumi)},switchDraft:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.slug)if(this.published_at){if(!n)return void this.$alert({title:"未对本次更改做保存",message:"切换后会丢失更新的内容，确认吗？",buttons:["取消","确认"],callback:function(n){n&&e.switchDraft(t,!0)}})}else this.actionUpdate(!1);this.$router.replace({name:this.$route.name,query:F({},this.$route.query,{slug:t})}),t?this.$axios.$get("v1/pin/update/content",{params:{slug:t}}).then((function(data){e.updatePageData(data)})).catch((function(t){e.$toast.info(t.message)})):this.clearPageData()}},head:{title:"投稿"}},Y=(n(321),Object(B.a)(W,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"write-pin"}},[n("div",{staticClass:"title"},[n("VField",{attrs:{"min-row":1,"max-row":2,"max-len":40,counter:"",placeholder:"标题（建议30字以内）"},model:{value:t.title.text,callback:function(e){t.$set(t.title,"text",e)},expression:"title.text"}})],1),t._v(" "),t.renderEditor?n("Editor",{attrs:{slug:t.slug},on:{save:t.onEditorSave},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}}):t._e(),t._v(" "),t.selectedBangumi?n("div",{staticClass:"info-wrap"},[n("p",{staticClass:"info-title"},[t._v("\n      请选择投稿分区\n    ")]),t._v(" "),n("VButton",{attrs:{plain:""},domProps:{textContent:t._s(t.selectedBangumi.name)},on:{click:function(e){t.toggleBangumiDrawer=!0}}})],1):t._e(),t._v(" "),n("div",{staticClass:"footer"},[t.published_at?[n("VButton",{attrs:{loading:t.loading},on:{click:function(e){return t.actionUpdate(!0)}}},[t._v("\n        更新文章\n      ")])]:[n("VButton",{attrs:{loading:t.loading},on:{click:function(e){return t.actionCreate(!0)}}},[t._v("\n        发布文章\n      ")]),t._v(" "),t.slug?n("VButton",{attrs:{loading:t.loading,theme:"info",plain:""},on:{click:function(e){return t.actionUpdate(!1)}}},[t._v("\n        存草稿\n      ")]):n("VButton",{attrs:{loading:t.loading,theme:"info",plain:""},on:{click:function(e){return t.actionCreate(!1)}}},[t._v("\n        存草稿\n      ")])],t._v(" "),t.draftSource.total?n("VButton",{attrs:{plain:""},on:{click:function(e){t.toggleDraftDrawer=!0}}},[t._v("\n      草稿箱("+t._s(t.draftSource.total)+")\n    ")]):t._e()],2),t._v(" "),n("div",{staticClass:"preload-wrap"},[n("FlowLoader",{ref:"draftLoader",attrs:{func:"getUserDrafts",type:"page",auto:0,query:{$axios:t.$axios}}}),t._v(" "),t.isAuth?n("FlowLoader",{ref:"areaLoader",attrs:{func:"getUserBangumi",type:"page",auto:0,query:{$axios:t.$axios,slug:t.currentUser.slug}}}):t._e()],1),t._v(" "),n("VDrawer",{model:{value:t.toggleDraftDrawer,callback:function(e){t.toggleDraftDrawer=e},expression:"toggleDraftDrawer"}},[n("FlowLoader",{attrs:{func:"getUserDrafts",type:"page",query:{$axios:t.$axios}},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.flow;return n("div",{},t._l(r,(function(e){return n("PinDraftItem",{key:e.slug,attrs:{item:e},on:{click:function(n){return t.switchDraft(e.slug)}}})})),1)}}])})],1),t._v(" "),n("VDrawer",{model:{value:t.toggleBangumiDrawer,callback:function(e){t.toggleBangumiDrawer=e},expression:"toggleBangumiDrawer"}},[n("FlowLoader",{attrs:{func:"getUserBangumi",type:"page",auto:0,query:{$axios:t.$axios,slug:t.currentUser.slug}},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.flow;return n("div",{},t._l(r,(function(e){return n("BangumiOptionItem",{key:e.slug,attrs:{item:e,"selected-slug":t.bangumi_slug,type:"select"},on:{click:function(n){return t.switchBangumi(e)}}})})),1)}}])})],1)],1)}),[],!1,null,null,null));e.default=Y.exports}}]);