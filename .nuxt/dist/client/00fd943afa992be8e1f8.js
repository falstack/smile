(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{238:function(t,n,e){"use strict";n.a={beforeMount:function(){var t=this;this.$channel.$when("user-not-sign",(function(){t.$toast.error("继续操作前请先登录").then((function(){t.$bridge.redirectTo({url:"/pages/user/login/index?from=".concat(encodeURIComponent(window.location.href))})}))}))}}},250:function(t,n,e){},295:function(t,n,e){"use strict";var o=e(250);e.n(o).a},371:function(t,n,e){"use strict";e.r(n);e(57),e(9),e(226),e(56);var o=e(227),r=e.n(o),c=e(238),l={name:"BangumiJoin",components:{QaItem:e(288).a,VButton:r.a},mixins:[c.a],data:function(){return{showLaunch:!0,showCreate:!1,rule:null,sheet:null,bangumi:null,questions:[],selected:{},extra:null,loading:!1}},computed:{slug:function(){return this.$route.query.slug}},mounted:function(){this.getBangumiInfo(),this.getBangumiRule()},methods:{getBangumiRule:function(){var t=this;this.$axios.$get("v1/join/rule/show",{params:{slug:this.slug}}).then((function(data){t.rule=data})).catch((function(n){t.$toast.error(n.message)}))},getBangumiInfo:function(){var t=this;this.$axios.$get("v1/bangumi/show",{params:{slug:this.slug}}).then((function(data){t.bangumi=data})).catch((function(n){t.$toast.error(n.message)}))},handleBegin:function(){var t=this;this.$axios.$post("v1/join/begin",{slug:this.slug}).then((function(n){"reject"===n?t.$toast.info("该分区还未开放"):"resolve"===n?t.$toast.info("你已加入该分区"):"no_rule"===n?t.$toast.info("还没有答题规则"):"no_question"===n?(t.$toast.info("分区题目数量不足"),t.showCreate=!0):"pending"===n&&t.getQuestions(),t.getQuestions()})).catch((function(n){t.$toast.error(n.message)}))},getQuestions:function(){var t=this;this.$axios.$get("v1/join/list",{params:{slug:this.slug}}).then((function(data){t.extra=data.extra,t.selected=data.extra.answers||{},t.questions=data.result,t.showLaunch=!1})).catch((function(n){t.$toast.error(n.message)}))},handleSelect:function(t){var n=this,e=t.questionId,o=t.answerId;this.$axios.$post("v1/join/vote",{question_id:e,answer_id:o}).then((function(){n.selected[e]=o})).catch((function(t){n.$toast.error(t.message)}))},handleSubmit:function(){var t=this;Object.keys(this.selected).length<this.questions.length?this.$toast.info("请先做完所有题目"):this.loading||(this.loading=!0,this.$axios.$post("v1/join/submit",{slug:this.slug}).then((function(n){t.$toast.info(n).then((function(){t.$bridge.redirectTo({url:"/pages/bangumi/show/index?slug=".concat(t.slug)})}))})).catch((function(n){t.$toast.error(n.message)})).finally((function(){t.loading=!1})))}},head:function(){return{title:"答题"}}},h=(e(295),e(24)),component=Object(h.a)(l,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{attrs:{id:"bangumi-join"}},[t.showLaunch?e("div",{staticClass:"launch"},[t.bangumi?[e("img",{staticClass:"avatar",attrs:{src:t.$resize(t.bangumi.avatar,{width:150}),alt:""}}),t._v(" "),e("p",[t._v("加入《"+t._s(t.bangumi.name)+"》")])]:t._e(),t._v(" "),t.rule?[e("ul",[e("li",[t._v("该番剧出题："+t._s(t.rule.question_count)+"道")]),t._v(" "),e("li",[t._v("正确率需要："+t._s(t.rule.right_rate)+"%")])])]:t._e(),t._v(" "),e("VButton",{attrs:{type:"success",round:""},on:{click:t.handleBegin}},[t._v("\n      开始答题\n    ")]),t._v(" "),t.showCreate?e("NLink",{attrs:{to:"/bangumi/test?slug="+t.slug}},[t._v("\n      出题\n    ")]):t._e()],2):[t._l(t.questions,(function(n,o){return e("QaItem",{key:n.id,attrs:{order:o,extra:t.extra,item:n},on:{select:t.handleSelect}})})),t._v(" "),e("VButton",{attrs:{block:"",loading:t.loading,size:"large"},on:{click:t.handleSubmit}},[t._v("\n      交卷\n    ")])]],2)}),[],!1,null,null,null);n.default=component.exports}}]);